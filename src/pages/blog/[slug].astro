---
import type { GetStaticPaths } from 'astro';
import { getCollection, render } from 'astro:content';
import Base from '../../layouts/Base.astro';
import '../../styles/global.css';

export const getStaticPaths = (async () => {
    const posts = await getCollection('posts');
    // Sort newest first for prev/next calculation
    posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

    return posts.map((post, index) => ({
        params: { slug: post.id.replace(/\.md$/, '') },
        props: {
            post,
            prevPost: index < posts.length - 1 ? posts[index + 1] : null,
            nextPost: index > 0 ? posts[index - 1] : null,
        },
    }));
}) satisfies GetStaticPaths;

const { post, prevPost, nextPost } = Astro.props;
const { Content } = await render(post);

const formatDate = (date: Date) => {
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: '2-digit',
    });
};
---

<Base title={`${post.data.title} — Noah Mancino`} headerStyle="post">
    <main class="main-content">
        <article>
            <header class="article-header">
                <h2 class="article-title">{post.data.title}</h2>
                <div class="article-date">{formatDate(post.data.date)}</div>
            </header>

            <div class="prose">
                <Content />
            </div>
        </article>
    </main>

    {(prevPost || nextPost) && (
        <nav class="post-nav">
            {prevPost ? (
                <a href={`/blog/${prevPost.id.replace(/\.md$/, '')}/`}>
                    <span class="arrow arrow-left">←</span>
                    Previous Post
                </a>
            ) : <span />}

            {nextPost ? (
                <a href={`/blog/${nextPost.id.replace(/\.md$/, '')}/`}>
                    Next Post
                    <span class="arrow arrow-right">→</span>
                </a>
            ) : <span />}
        </nav>
    )}
</Base>
